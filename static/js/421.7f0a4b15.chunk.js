"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[421],{9421:(t,e,r)=>{r.r(e),r.d(e,{default:()=>d});var o=r(5043),a=r(3216),c=r(3910),s=r(7929),n=r(579);const i=(0,o.lazy)((()=>r.e(220).then(r.bind(r,4220)))),d=()=>{const[t,e]=(0,o.useState)([]),[r,d]=(0,o.useState)({username:"",mobile_number:""}),[l,u]=(0,o.useState)(null),[m,h]=(0,o.useState)(!0),[p,v]=(0,o.useState)({}),g=(0,a.Zp)();(0,o.useEffect)((()=>{x(),y()}),[]);const x=async()=>{const t=localStorage.getItem("authToken");try{const e=await fetch("https://prasad-gz5p.onrender.com/api/user/details/",{headers:{Authorization:`Token ${t}`}});if(!e.ok)throw new Error("Failed to fetch customer details");const r=await e.json();d({username:r.username,mobile_number:r.mobile_number})}catch(e){u(e.message)}},y=async()=>{const t=localStorage.getItem("authToken"),o=r.mobile_number;try{h(!0);const r=await fetch(`https://prasad-gz5p.onrender.com/api/view-cart/?mobile=${o}`,{headers:{Authorization:`Token ${t}`}});if(!r.ok)throw new Error("Failed to fetch cart");const a=await r.json();e(a.cart_items||[]);const c={};a.cart_items.forEach((t=>{c[t.productItem.productid]=t.quantity})),v(c)}catch(a){console.error(a.message)}finally{h(!1)}};return(0,n.jsx)("div",{children:(0,n.jsx)("div",{className:"cart-container11",children:m?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"cart-spinner11",children:[(0,n.jsx)(i,{})," "]})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h2",{children:"Your Cart"}),(0,n.jsxs)("div",{className:"btns-total",children:[(0,n.jsxs)("p",{className:"view-cart-total11",children:["Total Price: \u20b9",t.reduce(((t,e)=>{const r=p[e.productItem.productid]||e.quantity;return t+e.price*r}),0)]}),(0,n.jsxs)("div",{className:"btnMain11",children:[(0,n.jsx)("button",{onClick:y,className:"view-cart-button11",children:"Refresh Cart"}),(0,n.jsx)("button",{onClick:async()=>{const t=localStorage.getItem("authToken"),o=r.mobile_number;try{const r=await fetch("https://prasad-gz5p.onrender.com/api/checkout/",{method:"POST",headers:{Authorization:`Token ${t}`,"Content-Type":"application/json"},body:JSON.stringify({mobile_number:o,volume:10})});if(!r.ok){await r.text();throw new Error(`Checkout failed: ${r.status} - ${r.statusText}`)}const a=await r.json();alert(`Checkout successful! Invoice ID: ${a.invoice_id}`),e([]),v({})}catch(a){u(a.message),console.error("Checkout Error:",a)}},className:"view-cart-button11-checkout",disabled:0===t.length,children:"Checkout"}),(0,n.jsx)("button",{onClick:()=>g("/order-history"),className:"view-cart-button11",children:"Order History"})]})]}),(0,n.jsxs)("div",{className:"cart-section11",children:[t.length>0?(0,n.jsx)("ul",{children:t.map((t=>{var r,o,a,i;return t&&t.productItem&&(0,n.jsx)("li",{children:(0,n.jsxs)("div",{className:"view-cart-item11",children:[(0,n.jsx)("div",{className:"image_container11",children:(0,n.jsx)("img",{src:null===(r=t.productItem)||void 0===r?void 0:r.productImage,alt:t.product_name,className:"image333",loading:"lazy"})}),(0,n.jsx)("div",{children:(0,n.jsxs)("strong",{children:["Category: ",(null===(o=t.productItem)||void 0===o?void 0:o.productCategory)||"N/A"]})}),(0,n.jsxs)("div",{className:"volumev210",children:["Type: ",(null===(a=t.productItem)||void 0===a?void 0:a.productType)||"N/A"]}),(0,n.jsxs)("div",{className:"volumev210",children:["Volume: ",(null===(i=t.productItem)||void 0===i?void 0:i.productVolume)||"N/A"]}),(0,n.jsxs)("div",{children:["Price of Product: \u20b9",t.price]}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",marginRight:"20px"},children:[(0,n.jsxs)("span",{children:[t.product_name," Quantity: "]}),(0,n.jsx)("input",{type:"number",min:"1",value:p[t.productItem.productid]||t.quantity,onChange:e=>{const r=parseInt(e.target.value)||1;(async(t,e)=>{const r=localStorage.getItem("authToken"),o={product_id:t,quantity:e};try{const a=await fetch(`https://prasad-gz5p.onrender.com/api/replace-quantity/${t}/`,{method:"POST",headers:{Authorization:`Token ${r}`,"Content-Type":"application/json"},body:JSON.stringify(o)});if(!a.ok)throw new Error(`Failed to update cart: ${a.statusText}`);v((r=>({...r,[t]:e})))}catch(a){alert("Error: "+a.message)}})(t.productItem.productid,r)},style:{width:"60px",marginLeft:"10px"}})]}),(0,n.jsxs)("div",{children:["Total Price of Product: \u20b9",t.price*(p[t.productItem.productid]||t.quantity)]}),(0,n.jsxs)("button",{className:"icon-remove11",onClick:()=>(async t=>{const r=localStorage.getItem("authToken");try{const o=await fetch(`https://prasad-gz5p.onrender.com/api/remove-entire-from-cart/${t}/`,{method:"DELETE",headers:{Authorization:`Token ${r}`,"Content-Type":"application/json"}});if(!o.ok)throw new Error(`Failed to remove item from cart: ${o.statusText}`);e((e=>e.filter((e=>e.productItem.productid!==t))))}catch(o){alert("Error: "+o.message)}})(t.productItem.productid),children:[(0,n.jsx)(c.g,{icon:s.yLS})," Remove"]})]})},t.productItem.productid)}))}):(0,n.jsx)("p",{children:"Your cart is empty"}),l&&(0,n.jsx)("p",{className:"error11",children:l})]})]})})})}}}]);
//# sourceMappingURL=421.7f0a4b15.chunk.js.map