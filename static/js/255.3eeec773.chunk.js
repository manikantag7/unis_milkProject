"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[255],{8255:(e,s,t)=>{t.r(s),t.d(s,{default:()=>i});var a=t(5043),r=t(3216),n=t(4594),c=t(579);const i=function(){const[,e]=(0,a.useState)({username:"",mobile_number:""}),[,s]=(0,a.useState)(null),[t,i]=(0,a.useState)([]),[o,l]=(0,a.useState)([]),[d,u]=(0,a.useState)({id:"",mobile_number:""}),[m,p]=(0,a.useState)(!1),[h,j]=(0,a.useState)(""),[x,b]=(0,a.useState)([]),[g,w]=(0,a.useState)(!1),[v,f]=(0,a.useState)(!1),[_,N]=(0,a.useState)(!1),[y,S]=(0,a.useState)({customer_id:"",product_id:"",new_price:""}),[C,k]=(0,a.useState)(""),[E,L]=(0,a.useState)(!1),[T,P]=(0,a.useState)(""),[z,A]=(0,a.useState)([]),F=(0,a.useRef)(null),I=(0,r.Zp)();(0,a.useEffect)((()=>{const e=localStorage.getItem("authToken");if(!e)return void I("/login");$(),(async()=>{f(!0);try{const s=await fetch("https://prasad-gz5p.onrender.com/api/manage-negotiated-prices/",{headers:{Authorization:`Token ${e}`}});if(!s.ok)throw new Error("Failed to fetch customer data");const t=await s.json();i(t.customers),l(t.customers)}catch(t){s(t.message)}finally{f(!1)}})()}),[I]),(0,a.useEffect)((()=>{const e=t.filter((e=>e.mobile_number.includes(h)));l(e)}),[h,t]);const $=async()=>{const t=localStorage.getItem("authToken");try{const s=await fetch("https://prasad-gz5p.onrender.com/api/user/details/",{headers:{Authorization:`Token ${t}`}});if(!s.ok)throw new Error("Failed to fetch customer details");const a=await s.json();e({username:a.username,mobile_number:a.mobile_number})}catch(a){s(a.message)}};return(0,a.useEffect)((()=>{const e=e=>{F.current&&!F.current.contains(e.target)&&p(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[F]),(0,a.useEffect)((()=>{const e=x.filter((e=>e.category&&e.category.toLowerCase().includes(T.toLowerCase())||e.volume&&e.volume.toLowerCase().includes(T.toLowerCase())||e.new_price&&e.new_price.toLowerCase().includes(T.toLowerCase())));A(e)}),[T,x]),(0,c.jsxs)("div",{className:"customer-home1p7",children:[(0,c.jsx)("h2",{children:"Customers"}),(0,c.jsxs)("div",{className:"customer-sectionp7",children:[(0,c.jsxs)("div",{className:"dropdownp7",ref:F,children:[(0,c.jsx)("button",{onClick:()=>{p(!m),m?F.current.classList.remove("dropdown-open"):F.current.classList.add("dropdown-open")},className:"dropdown-togglep7",children:d.mobile_number?(0,c.jsxs)(c.Fragment,{children:[d.mobile_number,(0,c.jsx)("span",{className:"cancel-iconp7",onClick:()=>{u({id:"",mobile_number:""}),b([])},children:"\xd7"})]}):"Select a Customer"}),m&&(0,c.jsxs)("div",{className:"dropdown-menup7",children:[(0,c.jsx)("input",{type:"text",placeholder:"Search by mobile number",value:h,onChange:e=>j(e.target.value),className:"search-inputp7"}),(0,c.jsx)("div",{className:"customer-list-containerp7",children:v?(0,c.jsx)("div",{className:"loader",children:"Loading customers..."}):o.length?(0,c.jsx)("ul",{className:"customer-listp7",children:o.map(((e,s)=>(0,c.jsx)("li",{onClick:()=>(e=>{u({id:e.id,mobile_number:e.mobile_number}),p(!1)})(e),children:e.mobile_number},s)))}):(0,c.jsx)("p",{className:"no-customersp7",children:"No customers found"})})]})]}),(0,c.jsx)("button",{onClick:async()=>{d.id&&await(async()=>{const e=localStorage.getItem("authToken");w(!0);try{const s=await fetch(`https://prasad-gz5p.onrender.com/api/manage-negotiated-prices/?customer=${d.id}`,{headers:{Authorization:`Token ${e}`}});if(!s.ok)throw new Error("Failed to fetch customer products");const t=await s.json();b(t.products),A(t.products)}catch(t){s(t.message)}finally{w(!1)}})()},className:"btn-submitp7",disabled:!d.id,children:"Submit Customer"}),(0,c.jsx)("input",{type:"text",placeholder:"Search...",value:T,onChange:e=>P(e.target.value),className:"search-barp7"})]}),g?(0,c.jsx)("div",{className:"spinnerp7",children:(0,c.jsx)(n.A,{})}):d.id&&x.length>0&&(0,c.jsx)("div",{children:(0,c.jsx)("div",{className:"product-card-containerp7",children:z.map(((e,s)=>(0,c.jsxs)("div",{className:"cardp7",children:[(0,c.jsx)("div",{className:"image_containerp7",children:(0,c.jsx)("img",{src:e.image_url,alt:e.description,className:"imagep7"})}),(0,c.jsxs)("div",{className:"bottom-sectionp7",children:[(0,c.jsx)("div",{className:"titlep7",children:(0,c.jsx)("p",{children:(0,c.jsx)("span",{children:e.category})})})," ",(0,c.jsx)("hr",{className:"border"}),(0,c.jsx)("div",{className:"volumep7",children:(0,c.jsxs)("span",{className:"qty",children:["Volume: ",(0,c.jsx)("span",{className:"volume-valuep7",children:e.volume})]})}),(0,c.jsx)("hr",{className:"border"}),(0,c.jsxs)("p",{className:"Final_pricep7",children:["Price: \u20b9",e.final_price]}),e.new_price&&(0,c.jsxs)("p",{style:{color:"red"},children:["New Price: \u20b9",e.new_price]})]}),(0,c.jsx)("button",{className:"edit-buttonp7",onClick:()=>{S({customer_id:d.id,product_id:e.id,new_price:""}),N(!0)},children:"Edit Price"})]},s)))})}),E&&(0,c.jsx)("div",{className:"popup-notificationp7",children:C}),_&&(0,c.jsx)("div",{className:"modalp7",children:(0,c.jsxs)("div",{className:"modal-contentp7",children:[(0,c.jsx)("h2",{children:"Edit Product Price for Customer"}),(0,c.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const s=localStorage.getItem("authToken");try{if(!(await fetch("https://prasad-gz5p.onrender.com/api/manage-negotiated-prices/",{method:"POST",headers:{Authorization:`Token ${s}`,"Content-Type":"application/json"},body:JSON.stringify(y)})).ok)throw new Error("Failed to update price");b((e=>e.map((e=>e.id===y.product_id?{...e,final_price:y.new_price}:e)))),k("Price updated successfully!")}catch(t){k("Error: "+t.message)}finally{N(!1),S({customer_id:"",product_id:"",new_price:""}),L(!0),setTimeout((()=>{L(!1)}),1e3)}},children:[(0,c.jsxs)("label",{children:["Customer ID:",(0,c.jsx)("input",{type:"number",name:"customer_id",value:y.customer_id,readOnly:!0})]}),(0,c.jsxs)("label",{children:["Product ID:",(0,c.jsx)("input",{type:"text",name:"product_id",value:y.product_id,readOnly:!0})]}),(0,c.jsxs)("label",{children:["New Price:",(0,c.jsx)("input",{type:"number",name:"new_price",value:y.new_price,onChange:e=>{const{name:s,value:t}=e.target;S({...y,[s]:t})},required:!0})]}),(0,c.jsx)("button",{type:"submit",children:"Submit"}),(0,c.jsx)("button",{type:"button",onClick:()=>N(!1),children:"Cancel"})]})]})})]})}},4594:(e,s,t)=>{t.d(s,{A:()=>r});t(5043);var a=t(579);const r=()=>(0,a.jsx)("div",{className:"dot-spinner-container",children:(0,a.jsx)("div",{className:"dot-spinner",children:Array.from({length:8},((e,s)=>(0,a.jsx)("div",{className:`dot-spinner__dot dot-spinner__dot--${s+1}`},s)))})})}}]);
//# sourceMappingURL=255.3eeec773.chunk.js.map